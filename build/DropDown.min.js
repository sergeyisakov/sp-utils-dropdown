(function(){var a;a=function(a,b){var c,d,e,f,g,h;return h=b(a.View),c=a.$,g=a.Model.extend({defaults:{text:"",value:"",active:!1}}),d=a.Collection.extend({model:g,refresh:function(a){return this.set(a)},normalize:function(a){return a.toLowerCase().replace(/[^a-zа-я0-9]/g,"")},search:function(a){var b;return b=new RegExp("^"+this.normalize(a),"g"),this.filter(function(a){return function(c){var d;return d=a.normalize(c.get("text")),b.test(d)}}(this))}}),e=h.extend({className:"dropdown_item",tagName:"li",events:{click:"onClick"},initialize:function(){return this.listenTo(this.model,{"change:text":this.onTextChange,"change:active":this.onActiveChange}),this.updateText(),this.updateActive()},updateText:function(){return this.$el.text(this.model.get("text"))},updateActive:function(){return this.model.get("active")?this.$el.addClass("active"):this.$el.removeClass("active")},onTextChange:function(){return this.updateText()},onActiveChange:function(){return this.updateActive()},onClick:function(){return this.model.set({active:!0})}}),f=h.extend({OPEN_CLASS:"open",className:"dropdown_list",itemView:e,templateFunc:function(){return"<button class=dropdown-list-button type='button'></button> <ul class=dropdown-list-menu></ul>"},ui:{menu:".dropdown-list-menu",button:".dropdown-list-button"},events:{click:"onClick"},initialize:function(a){return this.search=a.search,null==this.dataCollection&&(this.dataCollection=new d),null==this.collection&&(this.collection=new d),this.listenTo(this.collection,{"change:active":this.onChangeCollectionActive,add:this.onAddCollection,remove:this.onRemoveCollection}),this.currentActiveModel=null,this.isMenuOpen=!1,this.views={},this.__onBackdropClick=function(a){return function(b){return a.onBackdropClick(b)}}(this),this.__onSearch=function(a){return function(b){return a.onSearch(b)}}(this)},render:function(){return this.search?(this.searchField=c("<input class=dropdown-search placeholder=Найти...>"),this.ui.menu.append(this.searchField)):void 0},onShow:function(){return this.search&&this.$el.on("change keyup",".dropdown-search",this.__onSearch),c(window).on("click",this.__onBackdropClick)},onClose:function(){return this.search&&this.$el.off("change keyup",".dropdown-search",this.__onSearch),c(window).off("click",this.__onBackdropClick)},updateCollectionActive:function(a){var b;if(a.get("active"))return null!=(b=this.currentActiveModel)&&b.set({active:!1}),this.currentActiveModel=a,this.$input.val(a.get("value")),this.$input.trigger("change"),this.setButtonText(a.get("text"))},bindToInput:function(a){this.$input=a},setButtonText:function(a){return this.ui.button.text(a)},setData:function(a){return this.dataCollection.refresh(a),this.collection.refresh(a)},onSearch:function(){var a,b;return b=this.searchField.val(),a=this.dataCollection.search(b),this.collection.refresh(a)},onClick:function(a){var b,c,d;if(a.target!==(null!=(b=this.searchField)?b[0]:void 0))return this.isMenuOpen?(this.$el.removeClass(this.OPEN_CLASS),this.isMenuOpen=!1):(null!=(c=this.searchField)&&c.val("").trigger("change"),this.$el.addClass(this.OPEN_CLASS),this.isMenuOpen=!0,null!=(d=this.searchField)?d.focus():void 0)},onBackdropClick:function(a){var b;return b=c(a.target).parents("."+this.className)[0]===this.el,!b&&this.isMenuOpen?(this.$el.removeClass(this.OPEN_CLASS),this.isMenuOpen=!1):void 0},onAddCollection:function(a){var b;return this.views[a.cid]=b=new this.itemView({model:a}),this.ui.menu.append(b.$el),this.updateCollectionActive(a)},onRemoveCollection:function(a){return this.views[a.cid].remove()},onChangeCollectionActive:function(a){return this.updateCollectionActive(a)}}),f.version="0.0.6",f},"function"==typeof define&&"object"==typeof define.amd&&define.amd?define(["backbone","backbone-mixin"],function(b,c){return a(b,c)}):window.DropDown=a(Backbone,MixinBackbone)}).call(this);